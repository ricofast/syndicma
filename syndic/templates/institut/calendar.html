{% extends "base.html" %}
{% load i18n %}
{% load static %}
{% load crispy_forms_tags %}
{% block head_title %}
    <title>{% trans "Schedulling" %} {{ acayear }}</title>
{% endblock %}
{% block css %}
    {{ block.super }}
    <link rel="stylesheet" href={% static "vendor/Limitless_2_3/global_assets/js/plugins/fullcalender/main.min.css" %} >

    <style>

  body {
    margin-top: 40px;
    font-size: 14px;
    font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
  }

  #external-events {

    left: 2px;
    top: 20px;
    width: 250px;
    padding: 0 1px;
    border: 1px solid #ccc;
    background: #eee;
    text-align: left;
  }

  #external-events h4 {
    font-size: 16px;
    margin-top: 0;
    padding-top: 1em;
  }

  #external-events .fc-event {
    margin: 3px 0;
    cursor: move;
  }

  #external-events p {
    margin: 1.5em 0;
    font-size: 11px;
    color: #666;
  }

  #external-events p input {
    margin: 0;
    vertical-align: middle;
  }

  #calendar-wrap {
    margin-left: 20px;
  }

  #calendar {
    max-width: 1100px;
    margin: 0 auto;
  }

</style>
{% endblock css %}
{% block content %}
    <!-- Page header -->
    <div class="page-header">
        <div class="page-header-content header-elements-md-inline">
            <div class="page-title d-flex">
                <h4><i class="icon-arrow-left52 mr-2"></i> <span class="font-weight-semibold">{% trans "Home" %}</span> - {% trans "Academic Year Holidays" %} </h4>
                <a href="#" class="header-elements-toggle text-default d-md-none"><i class="icon-more"></i></a>
            </div>

            {% comment %}<div class="header-elements d-none text-center text-md-left mb-3 mb-md-0">
						<div class="btn-group">
							<button type="button" class="btn bg-indigo-400"><i class="icon-stack2 mr-2"></i> New report</button>
							<button type="button" class="btn bg-indigo-400 dropdown-toggle" data-toggle="dropdown"></button>
							<div class="dropdown-menu dropdown-menu-right">
								<div class="dropdown-header">Actions</div>
								<a href="#" class="dropdown-item"><i class="icon-file-eye"></i> View reports</a>
								<a href="#" class="dropdown-item"><i class="icon-file-plus"></i> Edit reports</a>
								<a href="#" class="dropdown-item"><i class="icon-file-stats"></i> Statistics</a>
								<div class="dropdown-header">Export</div>
								<a href="#" class="dropdown-item"><i class="icon-file-pdf"></i> Export to PDF</a>
								<a href="#" class="dropdown-item"><i class="icon-file-excel"></i> Export to CSV</a>
							</div>
						</div>
					</div>{% endcomment %}
        </div>
    </div>
    <!-- /page header -->

    <div class="d-md-flex align-items-md-start justify-content-center" id='wrap'>
        <div class="sidebar sidebar-light bg-transparent sidebar-component sidebar-component-left wmin-300 border-0 shadow-0 sidebar-expand-md">
            <div class="sidebar-content">
                <div class="card">
                    <div class="card-header bg-transparent header-elements-inline">
                        <span class="card-title font-weight-semibold">{% trans "Filter" %}</span>
                        <div class="header-elements">
                            <div class="list-icons">
                                <a class="list-icons-item" data-action="collapse"></a>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">

                        <div class="mb-3" id="external-events">
                            <h6>Courses</h6>
                            <div id='external-events-list'>
                                {% for course in courses %}

                                <div class='fc-event fc-h-event fc-daygrid-event fc-daygrid-block-event'>
                                    <div class='fc-event-main'>{{ course.id }}-{{ course }}</div>
                                </div>
                                {% endfor %}

                            </div>

                            <p>
                                <input type='checkbox' id='drop-remove' />
                                <label for='drop-remove'>remove after drop</label>
                            </p>
                        </div>





                    </div>
                </div>
            </div>
        </div>
        <div class="tab-content w-100">
            <div class="tab-pane fade active show" id="profile">
                <!-- Profile info -->
                <div class="card">
                    <div class="card-header header-elements-inline">
                        <h5 class="card-title">{% trans "Holidays" %} </h5>
                        <div class="header-elements">
                            <div class="list-icons">
                                <a class="list-icons-item" data-action="collapse"></a>
                                <a class="list-icons-item" data-action="reload"></a>
                                <a class="list-icons-item" data-action="remove"></a>
                            </div>
                        </div>
                    </div>

                    <div class="card-body">
                        <div id='calendar-wrap'>
                            <div id='calendar'></div>
                            {% csrf_token %}
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
                <div id="myModal" class="modal fade" tabindex="-1">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header bg-info">
								<h5 class="modal-title">{% trans "Add a Course to Schedule" %}</h5>
								<button type="button" class="close" data-dismiss="modal">&times;</button>
							</div>


								<div class="modal-body">
									<div class="form-group">
										<div class="row">
											<div class="col-sm-6">
												<label>{% trans "Course" %}</label>
                                                <select name="cars" id="cars" class="form-control">
                                                    {% for course in courses %}
                                                        <option value="{{ course.id }}">{{ course.title }}</option>
                                                    {% endfor %}
                                                </select>

											</div>


										</div>
									</div>

                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-link" data-dismiss="modal">Close</button>
                                        <button type="submit" class="btn bg-primary">Submit form</button>
                                    </div>
                                </div>

						</div>
					</div>
				</div>
{% endblock content %}


{% block project_js %}
    {{ block.super }}
    <script>

     document.addEventListener('DOMContentLoaded', function() {
    var containerEl = document.getElementById('external-events-list');
    new FullCalendar.Draggable(containerEl, {
      itemSelector: '.fc-event',
      eventData: function(eventEl) {
        return {
          title: eventEl.innerText.trim(),
        }
      }
    });

    //// the individual way to do it
    // var containerEl = document.getElementById('external-events-list');
    // var eventEls = Array.prototype.slice.call(
    //   containerEl.querySelectorAll('.fc-event')
    // );
    // eventEls.forEach(function(eventEl) {
    //   new FullCalendar.Draggable(eventEl, {
    //     eventData: {
    //       title: eventEl.innerText.trim(),
    //     }
    //   });
    // });

    /* initialize the calendar
    -----------------------------------------------------------------*/
         var el = document.getElementsByName("csrfmiddlewaretoken");
         csrf_value = el[0].getAttribute("value");
         var calendarEl = document.getElementById('calendar');

         var calendar = new FullCalendar.Calendar(calendarEl, {
             headerToolbar: {
                 left: '',
                 center: '',
                 right: ''
             },

             initialDate: '2019-12-30',
             navLinks: true, // can click day/week names to navigate views
             selectable: true,
             selectMirror: true,
             initialView: 'timeGridWeek',
             hiddenDays: [ 0 ],
             dayHeaderFormat: { weekday: 'long' },
             droppable: true, // this allows things to be dropped onto the calendar
             editable: true,
             dayMaxEvents: true, // allow "more" link when too many events
             allDaySlot: false,
             slotMinTime: "07:00:00",
            slotLabelFormat: [
            {
                hour: 'numeric',
                minute: '2-digit',
                meridiem: false
            }
            ],

             drop: function(arg) {
                 // is the "remove after drop" checkbox checked?
                 if (document.getElementById('drop-remove').checked) {
                     // if so, remove the element from the "Draggable Events" list
                     arg.draggedEl.parentNode.removeChild(arg.draggedEl);
                 }
             },
            eventReceive: function(arg) { // called when a proper external event is dropped

                 var start = moment(arg.event.start);
                 var end = start.clone().add(1, 'hour');
                 var str = arg.event.title;
                 var strx = str.split("-");
                 var title = strx[1];
                 var courseid = strx[0];
                 //console.log(courseid);
                 {#var id = arg.event.id;#}
                 $.ajax({
                         type: "GET",
                         url: '/institut/add_event',
                         data: {'courseid':courseid, 'title': title, 'start': start.format('Y-MM-DD HH:mm:ss'), 'end': end.format('Y-MM-DD HH:mm:ss'), csrfmiddlewaretoken: csrf_value},
                         dataType: "json",
                         success: function (json) {
                                setTimeout(
                                function()
                                {

                                    calendar.refetchEvents();
                                   // location.reload();
                                }, 0001);

                            // alert("Added Successfully");
                         },
                         failure: function (json) {
                             alert('There is a problem!!!');
                         }
                 });

             },
             select: function(arg) {
                 $("#myModal").modal();
                 //var title = prompt("Enter Event Title");
                 if (title) {

                     var start = moment(arg.start);
                     var end = moment(arg.end);

                     $.ajax({
                         type: "POST",
                         url: '/institut/add_event',
                         data: {'title': title, 'start': start.format('Y-MM-DD HH:mm:ss'), 'end': end.format('Y-MM-DD HH:mm:ss'), csrfmiddlewaretoken: csrf_value},
                         dataType: "json",
                         success: function (data) {
                             setTimeout(
                                function()
                                {
                                    location.reload();
                                }, 0001);
                            calendar.refetchEvents();

                             alert("Added Successfully");
                         },
                         failure: function (data) {
                             alert('There is a problem!!!');
                         }
                     });
                 }
             },
             eventResize: function(arg) {
                 var start = moment(arg.event.start);
                 var end = moment(arg.event.end);
                 var title = arg.event.title;
                 var id = arg.event.id;
                 $.ajax({
                     type: "POST",
                     url: '/institut/update',
                     data: {'title': title, 'start': start.format('Y-MM-DD HH:mm:ss'), 'end': end.format('Y-MM-DD HH:mm:ss'), 'id': id, csrfmiddlewaretoken: csrf_value},
                     dataType: "json",
                     success: function (json) {
                         calendar.refetchEvents();

                         //alert('Event Update');
                     },
                     failure: function (json) {
                         alert('There is a problem!!!');
                     }
                 });
             },

             eventDrop: function (arg) {
                 var start = moment(arg.event.start);
                 var end = moment(arg.event.end);
                 var title = arg.event.title;
                 var id = arg.event.id;

                 $.ajax({
                     type: "POST",
                     url: '/institut/update',
                     data: {'title': title, 'start': start.format('Y-MM-DD HH:mm:ss'), 'end': end.format('Y-MM-DD HH:mm:ss'), 'id': id, csrfmiddlewaretoken: csrf_value},
                     dataType: "json",
                     success: function (json) {
                        calendar.refetchEvents();

                        // alert('Event Update');
                     },
                     failure: function (json) {
                         alert('There is a problem!!!');
                     }
                 });
             },

             eventClick: function (arg) {

                 if (confirm("Are you sure you want to remove it?")) {
                    var id = arg.event.id;

                     $.ajax({
                         type: "GET",
                         url: '/institut/remove',
                         data: {'id': id},
                         dataType: "json",
                         success: function (data) {


                             arg.event.remove();
                         },
                         failure: function (data) {
                             alert('There is a problem!!!');
                         }
                     });
                 }
             },
         eventTimeFormat: { // like '14:30:00'
            hour: '2-digit',
            minute: '2-digit',
            meridiem: false
          },

            events: [
                 {% for event in object_list %}
                     {
                         title: '{{ event.name }}',
                         start: '{{ event.start | date:"Y-m-d H:i" }}',
                         end: '{{ event.end | date:"Y-m-d H:i" }}',
                         id: '{{ event.id }}',

                         {% if event.type == "DL" %}
                             color: '#8fdf82',
                         {% elif event.type == "CL" %}
                             color: '#ff9f89'
                         {% endif %}

                     },
                 {% endfor%}

            ],

         });

         calendar.render();

         {% if lang.code == "en" %}
             calendar.setOption('locale','en');
         {% elif lang.code == "fr" %}
             calendar.setOption('locale','fr');
         {% elif lang.code == "ar" %}
             calendar.setOption('locale','ar-ma');
         {% elif lang.code == "es" %}
             calendar.setOption('locale','es');
         {% endif %}
     });
    </script>
    {#<script src={% static "vendor/Limitless_2_3/global_assets/js/plugins/forms/styling/switchery.min.js" %}></script>#}
    <script src={% static "vendor/moment/moment.js" %}></script>
    <script src={% static "vendor/Limitless_2_3/global_assets/js/plugins/fullcalender/main.min.js" %}></script>

    {% comment %}<script src={% static "vendor/Limitless_2_3/global_assets/js/plugins/ui/fullcalendar/daygrid/main.min.js" %}></script>
	<script src={% static "vendor/Limitless_2_3/global_assets/js/plugins/ui/fullcalendar/timegrid/main.min.js" %}></script>
	<script src={% static "vendor/Limitless_2_3/global_assets/js/plugins/ui/fullcalendar/list/main.min.js" %}></script>
	<script src={% static "vendor/Limitless_2_3/global_assets/js/plugins/ui/fullcalendar/interaction/main.min.js" %}></script>
	<script src={% static "vendor/Limitless_2_3/global_assets/js/plugins/ui/fullcalendar/core/locales/ar.js" %}></script>{% endcomment %}

{#   <script src={% static "vendor/Limitless_2_3/assets/js/calender.js" %}></script>#}
    {#	<script src={% static "vendor/Limitless_2_3/global_assets/js/demo_pages/fullcalendar_advanced.js" %}></script>#}

    {#	<script src={% static "vendor/Limitless_2_3/global_assets/js/demo_pages/datatables_extension_select.js" %}></script>#}

{% endblock project_js %}